<ion-header [translucent]="true" id="main-content">
  <ion-toolbar>
    <ion-button fill="" slot="start">
      <ion-back-button></ion-back-button>
    </ion-button>
    <ion-title class="t-center">Chi tiết chấm điểm </ion-title>
    <ion-button
      slot="end"
      fill="clear"
      color="dark"
      style="
        --padding: 0;
        --padding-end: 0;
        --padding-top: 0;
        --padding-bottom: 0;
      "
    >
      <ion-icon name="search-outline" style="font-size: 20px"></ion-icon>
    </ion-button>
    <ion-buttons slot="end">
      <ion-menu-button>
        <ion-icon name="list-outline" style="font-size: 20px"></ion-icon
      ></ion-menu-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>
<ion-content>
  <ion-accordion-group
    [multiple]="true"
    style="margin: 5px"
    [value]="lstTreeOpen"
  >
    <ng-template #recursive let-nodes>
      <ng-container *ngFor="let node of nodes">
        <ion-accordion [value]="node.key">
          <ion-item slot="header" color="light" id="{{ node.id }}">
            <ion-label>{{ node.title }}</ion-label>
          </ion-item>

          <div style="padding: 5px 0" slot="content">
            <ng-container *ngIf="node.isGroup == true; else Child">
              <ng-container
                *ngTemplateOutlet="
                  recursive;
                  context: { $implicit: node.children }
                "
              ></ng-container>
            </ng-container>

            <ng-template #Child>
              <div class="ion-padding" slot="content">
                <ng-container *ngIf="node.isImg">
                  <label style="color: orange">[Chú ý: Tối thiểu 1 ảnh]</label>
                  <p style="color: red">
                    (*) Tiêu chí này bắt buộc chọn 1 hình ảnh
                  </p>
                  <ion-item>
                    <input
                      type="file"
                      (change)="onImageSelected($event, node.code)"
                      accept="image/*"
                    />
                  </ion-item>

                  <div
                    class="image-wrapper"
                    *ngFor="let img of filterImage(node.code)"
                  >
                    <ion-img
                      [src]="img"
                      class="image-preview"
                      (click)="openFullScreen(img)"
                    ></ion-img>
                  </div>
                </ng-container>

                <ion-radio-group
                  [value]="filterDiem(node.code)"
                  (ionChange)="setDiem(node.code, $event)"
                >
                  <ng-container *ngFor="let diem of node.diemTieuChi">
                    <ion-item>
                      <ion-label>{{ diem.moTa }}</ion-label>
                      <ion-radio slot="end" [value]="diem.id"></ion-radio>
                    </ion-item>
                  </ng-container>
                </ion-radio-group>

                <label>
                  {{ node.title }}
                </label>
              </div>
            </ng-template>
          </div>
        </ion-accordion>
      </ng-container>
    </ng-template>

    <!-- Bắt đầu render từ gốc -->
    <ng-container
      *ngTemplateOutlet="recursive; context: { $implicit: treeData }"
    ></ng-container>
  </ion-accordion-group>
</ion-content>

<ion-footer>
  <ion-button
    (click)="onSubmit()"
    expand="full"
    (click)="(1)"
    style="width: 100%; font-weight: 700"
    >Chấm điểm</ion-button
  >
</ion-footer>

<ion-menu side="end" contentId="main-content" [style.--width]="'85%'">
  <ion-header>
    <ion-toolbar>
      <ion-title>
        <ion-grid>
          <ion-row>
            <ion-col size="6"
              ><span style="background-color: blue" class="circle"></span>Đã trả
              lời</ion-col
            >
            <ion-col size="6"
              ><span style="background-color: grey" class="circle"></span>Chưa
              lưu</ion-col
            >
            <ion-col size="6"
              ><span style="background-color: green" class="circle"></span>Đang
              chọn</ion-col
            >
            <ion-col size="6"
              ><span style="background-color: red" class="circle"></span>Không
              đạt</ion-col
            >
          </ion-row>
        </ion-grid>
      </ion-title>
    </ion-toolbar>
  </ion-header>
  <ion-content class="ion-padding">
    <div style="gap: 10px; display: flex; flex-wrap: wrap;">
    <a
      style="padding-left: 5px"
      *ngFor="let item of lstTieuChi; let i = index"
      href="survey/store/evaluate#{{ item.id }}"
      class="custom-button"
      [ngClass]="{ 'active-link': isActive(item.id), 'answered': isAnswered(item.code), }"
      (click)="setItem(item.id)"
    >
      {{ i + 1 }}
    </a>
    </div>
  </ion-content>
  <ion-footer>
    <!-- <ion-item> -->
    <ion-list>
      <ion-item style="height: 36px">
        <ion-label style="margin: 0; display: block; line-height: 1.2"
          >Người chấm</ion-label
        >
        <ion-label style="margin: 0; display: block; line-height: 1.2"
          >Nguyễn Thị Lân</ion-label
        >
      </ion-item>
      <ion-item style="height: 40px">
        <ion-label>Lần chấm thứ 2</ion-label>
        <ion-label>07/08/2002</ion-label>
      </ion-item>
      <ion-item>
        <ion-label>Tổng</ion-label>
        <ion-label>53</ion-label>
      </ion-item>
      <ion-item>
        <ion-label>Đã chấm</ion-label>
        <ion-label>53</ion-label>
      </ion-item>
      <ion-item>
        <ion-label>Chưa chấm</ion-label>
        <ion-label>53</ion-label>
      </ion-item>
    </ion-list>
    <!-- </ion-item> -->
  </ion-footer>
  <!-- </div> -->
</ion-menu>

<!-- view ảnh -->
<!-- <ion-modal [isOpen]="isImageModalOpen" (didDismiss)="closeFullScreen()">
  <ng-template>
    <ion-content class="full-image-content">
      <div class="image-container">
        <img [src]="selectedImage" class="full-image" />
      </div>
    </ion-content>
  </ng-template>
</ion-modal> -->

<ion-modal [isOpen]="isImageModalOpen" (didDismiss)="isImageModalOpen = false">
  <ng-template>
    <ion-content class="full-image-content" (click)="closeFullScreen()">
      <ion-button
        class="delete-button"
        fill="clear"
        color="danger"
        (click)="confirmDeleteImage()"
      >
        <ion-icon name="trash-outline" slot="end"></ion-icon>
      </ion-button>
      <img [src]="selectedImage" class="full-image" />
    </ion-content>
  </ng-template>
</ion-modal>
<!-- <ion-modal [isOpen]="isImageModalOpen" (didDismiss)="closeFullScreen()">
  <ion-content class="full-image-content">
    <div class="image-container">
      <img [src]="selectedImage" class="full-image" />
      <ion-button class="delete-button" fill="clear" color="danger" (click)="confirmDeleteImage()">
        <ion-icon name="trash-outline"></ion-icon>
      </ion-button>
    </div>
  </ion-content>
</ion-modal> -->
